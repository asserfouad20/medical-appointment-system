<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Appointments - Medical Appointment System</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <header class="header">
        <nav class="nav">
            <a href="#" class="logo">MediCare Admin</a>
            <ul class="nav-links">
                <li><a href="admin-dashboard.html">Dashboard</a></li>
                <li><a href="manage-doctors.html">Manage Doctors</a></li>
                <li><a href="admin-all-appointments.html">All Appointments</a></li>
                <li><a href="manage-schedules.html">Manage Schedules</a></li>
                <li><a href="settings.html">Settings</a></li>
                <li><a href="#" id="logoutBtn">Logout</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div class="dashboard-header">
            <h1 class="dashboard-title">All Appointments</h1>
            <p class="dashboard-subtitle">View and filter all appointments in the system</p>
        </div>

        <div class="card mb-3">
            <div class="card-body">
                <div class="grid grid-2 gap-2">
                    <div>
                        <select id="filterDoctor" class="form-select">
                            <option value="">All Doctors</option>
                        </select>
                    </div>
                    <div>
                        <select id="filterStatus" class="form-select">
                            <option value="">All Status</option>
                            <option value="booked">Booked</option>
                            <option value="done">Done</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="card table-card">
            <table class="table">
                <thead>
                    <tr>
                        <th>Patient</th>
                        <th>Doctor</th>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Status</th>
                        <th>Payment</th>
                    </tr>
                </thead>
                <tbody id="appointmentsTable">
                    <!-- Appointments will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>

    <script src="../js/app.js"></script>
    <script>
        // Check authentication
        if (!utils.requireAuth('admin')) {
            window.location.href = '../index.html';
        }

        // Populate doctor filter
        const filterDoctor = document.getElementById('filterDoctor');
        mockData.doctors.forEach(doctor => {
            const option = document.createElement('option');
            option.value = doctor.id;
            option.textContent = doctor.name;
            filterDoctor.appendChild(option);
        });

        function displayAppointments(appointments) {
            const tbody = document.getElementById('appointmentsTable');
            tbody.innerHTML = '';

            if (appointments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center">No appointments found</td></tr>';
                return;
            }

            appointments.forEach(apt => {
                const doctor = utils.getDoctorById(apt.doctorId);
                const patient = utils.getPatientById(apt.patientId);

                let statusBadgeClass = 'badge-info';
                if (apt.status === 'done') statusBadgeClass = 'badge-success';
                else if (apt.status === 'cancelled') statusBadgeClass = 'badge-danger';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${patient.name}</td>
                    <td>${doctor.name}<br><small style="color: var(--text-light);">${doctor.specialty}</small></td>
                    <td>${utils.formatDate(apt.date)}</td>
                    <td>${apt.time}</td>
                    <td><span class="badge ${statusBadgeClass}">${apt.status}</span></td>
                    <td>${apt.paymentMethod === 'visa' ? 'Paid Online' : 'Cash'}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function filterAppointments() {
            const doctorFilter = document.getElementById('filterDoctor').value;
            const statusFilter = document.getElementById('filterStatus').value;

            let filtered = mockData.appointments;

            if (doctorFilter) {
                filtered = filtered.filter(apt => apt.doctorId === parseInt(doctorFilter));
            }

            if (statusFilter) {
                filtered = filtered.filter(apt => apt.status === statusFilter);
            }

            // Sort by date
            filtered.sort((a, b) => new Date(b.date) - new Date(a.date) || b.time.localeCompare(a.time));

            displayAppointments(filtered);
        }

        // Event listeners
        document.getElementById('filterDoctor').addEventListener('change', filterAppointments);
        document.getElementById('filterStatus').addEventListener('change', filterAppointments);

        // Initial display
        filterAppointments();

        document.getElementById('logoutBtn').addEventListener('click', (e) => {
            e.preventDefault();
            utils.logout();
        });
    </script>
</body>
</html>
